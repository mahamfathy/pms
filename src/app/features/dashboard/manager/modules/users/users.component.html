<section>
  <div class="header flex-column shadow-sm d-flex">
    <div class="wrapper d-flex justify-content-between">
      <h1>Users</h1>
      <button class="orange-btn px-4" routerLink="add-manager">
        <mat-icon> add </mat-icon> Add new user
      </button>
    </div>
  </div>
  <div class="container px-3">
    <div class="row column-gap-3 p-2 ms-4 my-4">
      <mat-form-field class="search">
        <mat-label>Search by</mat-label>
        <mat-select
          [(ngModel)]="searchBy"
          (selectionChange)="updateSearchPlaceholder(searchBy)"
        >
          <mat-option value="userName">Name</mat-option>
          <mat-option value="email">Email</mat-option>
          <mat-option value="country">Country</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="search2" appearance="outline">
        <mat-label>{{ searchLabel }}</mat-label>
        <input
          (keydown.enter)="getAllUsers()"
          matInput
          [(ngModel)]="searchVal"
          [placeholder]="searchPlaceholder"
        />
        <mat-icon matSuffix>{{ searchIcon }}</mat-icon>
      </mat-form-field>
      <mat-form-field class="search">
        <mat-label>Role</mat-label>
        <mat-select [(ngModel)]="roleId" (selectionChange)="getAllUsers()">
          <mat-option [value]="[1, 2]">All</mat-option>
          <mat-option [value]="1">Manager</mat-option>
          <mat-option [value]="2">Employee</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="search">
        <mat-label>Filter users</mat-label>
        <mat-select
          [(ngModel)]="filterType"
          (selectionChange)="onFilterTypeChange()"
        >
          <mat-option value="all">All users</mat-option>
          <mat-option value="my">My users</mat-option>
        </mat-select>
      </mat-form-field>

      <button type="button" class="orange-btn" (click)="clearFilters()">
        Clear Filters
      </button>
    </div>
    <table (matSortChange)="sortData($event)" matSort class=" mat-elevation-z8">
      <thead>
        <tr class="header">
          <th mat-sort-header="userName">User name</th>
          <th mat-sort-header="isActivated">Status</th>
          <th mat-sort-header="phoneNumber">Phone number</th>
          <th mat-sort-header="email">Email</th>
          <th mat-sort-header="country">Country</th>
          <th mat-sort-header="imagePath">Image</th>
          <th >actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of sortedData;let i = index" [ngClass]="{'even-row': i % 2 === 0}">
          <td>{{ item.userName }}</td>

          <td>
            <button
              class="btn px-2 py-1 text-white"
              [ngClass]="item.isActivated ? 'bg-success' : 'bg-danger'"
            >
              {{ item.isActivated  ? "Active" : "Inactive"}}
            </button>
          </td>
          <td>{{ item.phoneNumber}}</td>
          <td>{{ item.email }}</td>
          <td>{{ item.country}}</td>
          <td><img
            class="my-2"
            [src]="
              item.imagePath
                ? 'https://upskilling-egypt.com:3003/' + item.imagePath
                : 'assets/images/defaultAvatar.avif'
            "
            alt="avatar"
          /></td>
          <td>

            <button mat-button [matMenuTriggerFor]="menu">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu class="" #menu="matMenu">
              <ng-container *ngFor="let action of actions">
                <button
                  class="justify-content-center"
                  mat-menu-item
                  *ngIf="action.name === 'View'"
                  style="color: orange"
                  (click)="viewUser(item)"
                >
                  <mat-icon style="color: orange">{{ action.icon }}</mat-icon>
                  <span>{{ action.name }}</span>
                </button>
                <button
                  *ngIf="action.name === 'Block' && !item.isActivated"
                  mat-menu-item
                  (click)="toggleBlock(item)"
                  class="justify-content-center"
                >
                  <mat-icon>lock_open</mat-icon>
                  <span>Unblock</span>
                </button>

                <button
                  *ngIf="action.name === 'Unblock' && item.isActivated"
                  mat-menu-item
                  (click)="toggleBlock(item)"
                  class="justify-content-center"
                >
                  <mat-icon style="color: gray">block</mat-icon>
                  <span style="color: gray">Block</span>
                </button>
              </ng-container>
            </mat-menu>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</section>
<mat-paginator
  [length]="tableRes?.totalNumberOfRecords"
  [pageSize]="pageSize"
  (page)="handlePageEvent($event)"
  [pageSizeOptions]="[10, 25, 50, 100]"
  aria-label="Select page"
>
</mat-paginator>
